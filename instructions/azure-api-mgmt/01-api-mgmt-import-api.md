---
lab:
  topic: Azure API Management
  title: Azure API Management を使用して API をインポートおよび構成する
  description: OpenAPI 仕様に準拠した API をインポート、発行、テストする方法について説明します。
---

# Azure API Management を使用して API をインポートおよび構成する

この演習では、Azure API Management インスタンスを作成し、OpenAPI 仕様のバックエンド API をインポートし、Web サービス URL やサブスクリプション要件などの API 設定を構成し、API 操作をテストして正しく機能することを確認します。

この演習で実行されるタスク:

* Azure API Management (APIM) インスタンスを作成する
* API をインポートする
* バックエンド設定を構成する
* API をテストする

この演習の所要時間は約 **20** 分です。

## API Management インスタンスの作成

演習のこのセクションでは、リソース グループと Azure Storage アカウントを作成します。 また、エンドポイントとアカウント用アクセス キーも記録します。

1. お使いのブラウザーで Azure portal ([https://portal.azure.com](https://portal.azure.com)) に移動し、メッセージに応じて Azure 資格情報を使用してサインインします。

1. ページ上部の検索バーの右側にある **[\>_]** ボタンを使用して、Azure portal 内に新しいクラウド シェルを作成します。***Bash*** 環境を選択すること。 Azure portal の下部にあるペインに、Cloud Shell のコマンド ライン インターフェイスが表示されます。 ファイルを保持するストレージ アカウントを選択するように求められた場合は、**[ストレージ アカウントは必要ありません]**、お使いのサブスクリプションを選択し、**[適用]** を選択します。

    > **注**: *PowerShell* 環境を使用するクラウド シェルを以前に作成している場合は、それを ***Bash*** に切り替えること。

1. この演習に必要なリソースのリソース グループを作成します。 **myResourceGroup** をリソース グループに使用する名前に置き換えます。 必要に応じて、**eastus2** を最寄りのリージョンに置き換えることができます。 使用するリソース グループが既にある場合は、次の手順に進みます。

    ```azurecli
    az group create --location eastus2 --name myResourceGroup
    ```

1. CLI コマンドで使用する変数をいくつか作成すると、入力作業を軽減できます。 **<myLocation>** を前の手順で選択した値に置き換えます。 APIM 名はグローバルに一意の名前にする必要があります。次のスクリプトによってランダムな文字列が生成されます。 **<myEmail>** を、アクセスできるメール アドレスに置き換えます。 **<myResourceGroup>** を前の手順で選択した値に置き換えます。

    ```bash
    myApiName=import-apim-$RANDOM
    myLocation=<myLocation>
    myEmail=<myEmail>
    myResourceGroup=<myResourceGroup>
    ```

1. APIM インスタンスを作成します。 **az apim create** コマンドを使用してインスタンスを作成します。

    ```bash
    az apim create -n $myApiName \
        --location $myLocation \
        --publisher-email $myEmail  \
        --resource-group $myResourceGroup \
        --publisher-name Import-API-Exercise \
        --sku-name Consumption
    ```
    > **注:**  この操作は、約 5 分で完了します。

## バックエンド API をインポートする

このセクションでは、OpenAPI の仕様のバックエンド API をインポートおよび発行する方法を示します。

1. Azure portal で、**API Management サービス** を検索して選択します。

1. **[API Management サービス]** 画面で、作成した API Management インスタンスを選択します。

1. **[API Management サービス]** ナビゲーション ウィンドウで **[> API]** を選択し、次に **[API]** を選択します。

    ![ナビゲーション ウィンドウの [API] セクションのスクリーンショット。](./media/select-apis-navigation-pane.png)


1. **[定義から作成]** セクションで **[OpenAPI]** を選択し、表示されるポップアップで **[基本/完全]** トグルを **[完全]** に設定します。

    次の表の値を使用してフォームに入力します。 記載されていないフィールドはすべて既定値のままにすることができます。

    | 設定 | 値 | 説明 |
    |--|--|--|
    | **OpenAPI 仕様** | `https://petstore.swagger.io/v2/swagger.json` | API を実装するサービスを参照します。要求は、このアドレスに転送されます。 この値を入力すると、フォームに必要な情報のほとんどが自動的に入力されます。 |
    | **URL スキーム** | **[HTTPS]** が選択されていることを確認します。 | API が受け入れる HTTP プロトコルのセキュリティ レベルを定義します。 |

1. **［作成］** を選択します

## API のテスト

API がインポートされて構成されたので、次は API をテストします。

1. メニュー バーの **[テスト]** を選択します。 これにより、API で使用できるすべての操作が表示されます。

1. **[Find Pets by status]** を探して選択します。 操作を完了するための次の手順について引き続き調査中です。
1. **[テンプレート パラメーター]** セクションで、**[状態]** フィールドに値として `available` を入力します。

1. **[Send]** を選択します。 必要に応じて、ページを下にスクロールして HTTP 応答を表示します。

    バックエンドは **200 OK** といくつかのデータで応答します。

1. 別の結果を試す場合は、**[テンプレート パラメーター]** セクションで別の **[状態]** を入力できます。 値として `pending` または `sold` を入力し、**[送信]** を選択すると、新しい結果が表示されます。

## リソースをクリーンアップする

これで演習が完了したので、不要なリソース使用を避けるために、作成したクラウド リソースを削除してください。

1. お使いのブラウザーで Azure portal ([https://portal.azure.com](https://portal.azure.com)) に移動し、メッセージに応じて Azure 資格情報を使用してサインインします。
1. 作成したリソース グループに移動し、この演習で使用したリソースの内容を表示します。
1. ツール バーの **[リソース グループの削除]** を選びます。
1. リソース グループ名を入力し、削除することを確認します。

> **注:** リソース グループを削除すると、その中のすべてのリソースが削除されます。 この演習で既存のリソース グループを選択した場合は、この演習の範囲外にある既存のリソースも削除されます。
